name: Validate Branch Name

on:
  push:
    branches:
      - "**"

jobs:
  check-branch:
<<<<<<< HEAD
    runs-on: self-hosted
=======
    runs-on: hng-13-runner
>>>>>>> befaac0 (fix: update workflow runner)
    steps:
      - name: Get branch name
        id: branch
        run: echo "branch_name=${GITHUB_REF#refs/heads/}" >> $GITHUB_OUTPUT

      - name: Enforce branch naming convention
        run: |
          BRANCH="${{ steps.branch.outputs.branch_name }}"

          echo "Branch: $BRANCH"

          # Allowed base branches
          if echo "$BRANCH" | grep -Eq '^(main|master|dev(elop)?|staging|hotfix|release)$'; then
            echo "✅ Allowed base branch: $BRANCH"
            exit 0
          fi

          # Enforce simple feature branch naming, e.g. feature/what-i-am-working-on
          if echo "$BRANCH" | grep -Eq '^(feature|fix|chore|hotfix|bugfix|refactor)/[a-z0-9-]+$'; then
            echo "✅ Valid feature branch name: $BRANCH"
            exit 0
          fi

          echo "❌ Invalid branch name: $BRANCH"
          echo "Branch name must match one of the following:"
          echo "  - main, master, dev, develop, staging, hotfix, release"
          echo "  - <type>/<slug>, e.g.:"
          echo "      feature/setup-fastapi-backend"
          echo "      fix/health-endpoint-timeout"
          echo "      chore/update-readme"
          echo "      refactor/split-db-layer"
          exit 1
